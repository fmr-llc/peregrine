<?xml version="1.0" encoding="UTF-8"?>
<beans  xmlns="http://www.springframework.org/schema/beans"
        xmlns:context="http://www.springframework.org/schema/context"
        xmlns:mvc="http://www.springframework.org/schema/mvc" 
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:p="http://www.springframework.org/schema/p"
        xmlns:tx="http://www.springframework.org/schema/tx"
        xsi:schemaLocation="
            http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/context 
            http://www.springframework.org/schema/context/spring-context.xsd
            http://www.springframework.org/schema/mvc
            http://www.springframework.org/schema/mvc/spring-mvc.xsd
            http://www.springframework.org/schema/tx
            http://www.springframework.org/schema/tx/spring-tx-4.2.xsd">
	
	<!--  scan for controller -->
    <context:component-scan base-package="com.alliancefoundry.controller"/>

     <!-- bean configuration -->
    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver">
        <property name="prefix">
            <value>/WEB-INF/pages/</value>
        </property>
        <property name="suffix">
            <value>.jsp</value>
        </property>
    </bean>
    
    <bean id="propertyConfigurer"
		class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
		<property name="locations">
			<list>
				<value>classpath:broker.properties</value>
				<value>classpath:db.properties</value>
			</list>
		</property>
	</bean>
	
	<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
	 	<property name="driverClassName" value="${db.driver}"/>
	 	<property name="url" value="${db.url}"/>
	 	<property name="username" value="${db.username}"/>
	 	<property name="password" value="${db.password}"/>
	</bean>
	 
	 <bean id="kafkaPublisher" class="com.alliancefoundry.publisher.KafkaPublisher">
		<property name="brokerUrl" value="${kafka.url}" />
		<!--  <property name="destType" value="${dest.kafka}" />-->
	</bean>
	
	<bean id="activemqPublisher" class="com.alliancefoundry.publisher.ActiveMQPublisher">
		<property name="brokerUrl" value="${activemq.url}" />
		<!--  <property name="destType" value="${dest.activemq}" />-->
	</bean>
	
	<bean id="activemqSubscriber1" class="com.alliancefoundry.tests.ActiveMQSubscriber">
		<property name="brokerUrl" value="${activemq.url}" />
		<property name="name" value="${activemq.name1}" />
	</bean>
	
	<bean id="activemqSubscriber2" class="com.alliancefoundry.tests.ActiveMQSubscriber">
		<property name="brokerUrl" value="${activemq.url}" />
		<property name="name" value="${activemq.name2}" />
	</bean>
	
	<bean id="eventPublisherservice" class="com.alliancefoundry.publisher.EventServicePublisher">
		<property name="publishers">
			<bean class="org.springframework.beans.factory.config.MapFactoryBean">
				<property name="targetMapClass">
					<value>java.util.HashMap</value>
				</property>
				<property name="sourceMap">
					<map key-type="java.lang.String" value-type="com.alliancefoundry.publisher.PublisherInterface">
            			<entry key="kafka"><ref bean="kafkaPublisher"/></entry>
            			<entry key="activemq"><ref bean="activemqPublisher"/></entry>
					</map>
				</property>
			</bean>
		</property>
	</bean>
	
    <mvc:annotation-driven />
		
	<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<bean id="dao" class="com.alliancefoundry.dao.JdbcTemplateDaoImpl">
		<constructor-arg ref="jdbcTemplate" />
	</bean>
	
	<bean id="dataSourceTransactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<constructor-arg ref="dataSource" />
	</bean>
	
	<tx:annotation-driven transaction-manager="dataSourceTransactionManager"/>

</beans>